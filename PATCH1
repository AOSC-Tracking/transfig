From heb@regent.e-technik.tu-muenchen.de Tue Jan 14 02:18:54 1992
Return-Path: <heb@regent.e-technik.tu-muenchen.de>
Received: by epb7.lbl.gov (5.57/SMI-3.2)
	id AA19000; Tue, 14 Jan 92 02:18:43 -0800
Received: from regency.regent.e-technik.tu-muenchen.de by tumuc.regent.e-technik.tu-muenchen.de with SMTP
	(5.61++L2/TUMUC-V3.20) id AA07611; Tue, 14 Jan 92 10:14:20 +0100
Date: Tue, 14 Jan 92 10:14:20 +0100
From: Herbert Bauer <heb@regent.e-technik.tu-muenchen.de>
Received: by regency
	(5.57/TUMUC.SATHOST-V4.0) id AA11479; Tue, 14 Jan 92 10:13:53 +0100
Message-Id: <9201140913.AA11479@regency>
To: beck@cs.cornell.edu
Subject: A few bug fixes for fig2dev
In-Reply-To: Mail from 'beck@cs.cornell.edu (Micah Beck)'
      dated: Sat, 21 Dec 91 15:02:08 -0500
Cc: king@cs.uq.oz.au, envbvs@epb7.lbl.gov, pusateri@cs.duke.edu
Status: OR

Micah,

following are a few patches for fig2dev.

Bug fixes:

genlatex.c: Rotated text didn't work for negative angles.
            Reduction was not accurate enough so that text and
            figures were shifted when using pstex.

genps.c:    ISO-Character encoding corrected.
            Multiple page output didn't work in landscape mode


I won't be here for two weeks starting Friday 17th. I'm going to
LA for a conference. See you,

          Herbert

-------------------------- to cut or not to cut --------------------

*** ../transfig.2.1.4/./patchlevel.h	Fri Dec  6 02:36:07 1991
--- ./patchlevel.h	Tue Jan 14 09:50:24 1992
***************
*** 1,2 ****
  #define VERSION		"2.1.4"
! #define PATCHLEVEL	"0"
--- 1,2 ----
  #define VERSION		"2.1.4"
! #define PATCHLEVEL	"1"
*** ../transfig.2.1.4/./fig2dev/dev/genlatex.c	Thu Nov 21 01:27:39 1991
--- ./fig2dev/dev/genlatex.c	Wed Jan  8 12:35:23 1992
***************
*** 90,93 ****
--- 90,94 ----
  #define	ABS(x)		(((x) >= 0)? (x): -(x))
  #define round4(x)	((round(10000.0*(x))/10000.0))
+ #define round6(x)	((round(1000000.0*(x))/1000000.0))
  
  char		thindot [] = THINDOT;
***************
*** 225,230 ****
  
  	/* LaTeX start */
! 	fprintf(tfp, "\\setlength{\\unitlength}{%.4fin}%%\n",
! 						round4(unitlength));
  	fprintf(tfp, "\\begin{picture}(%d,%d)(%d,%d)\n",
  	 				 urx-llx, ury-lly, llx, lly);
--- 226,231 ----
  
  	/* LaTeX start */
! 	fprintf(tfp, "\\setlength{\\unitlength}{%.6fin}%%\n",
! 						round6(unitlength));
  	fprintf(tfp, "\\begin{picture}(%d,%d)(%d,%d)\n",
  	 				 urx-llx, ury-lly, llx, lly);
***************
*** 662,666 ****
  #ifdef DVIPS
          if(t->angle && t->type == T_LEFT_JUSTIFIED)
!           fprintf(tfp, "\\special{ps:gsave currentpoint currentpoint translate\n-%.1f rotate neg exch neg exch translate}", t->angle*180/M_PI);
  #endif
  
--- 663,667 ----
  #ifdef DVIPS
          if(t->angle && t->type == T_LEFT_JUSTIFIED)
!           fprintf(tfp, "\\special{ps:gsave currentpoint currentpoint translate\n%.1f rotate neg exch neg exch translate}", -t->angle*180/M_PI);
  #endif
  
*** ../transfig.2.1.4/./fig2dev/dev/genps.c	Wed Dec  4 19:23:17 1991
--- ./fig2dev/dev/genps.c	Tue Jan 14 09:48:16 1992
***************
*** 29,32 ****
--- 29,34 ----
   *      multiple page output, color mode etc.
   *      heb@regent.e-technik.tu-muenchen.de
+  *
+  *	Modified by Eric Picheral to support the whole set of ISO-Latin-1
  */
  
***************
*** 114,198 ****
  newfontname newfont definefont pop end } def\n\
  /isovec [ \n\
! 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde \n\
! 8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis \n\
! 8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek \n\
! 8#214 /caron \n\
! 8#244 /currency \
! 8#252 /ordfeminine \
! 8#255 /endash \
! 8#270 /oslash \
! \n\
! 8#271 /dotlessi \
! 8#272 /ordmasculine \
! 8#300 /Agrave \
! 8#301 /Aacute \
! \n\
! 8#302 /Acircumflex \
! 8#303 /Atilde \
! 8#304 /Adieresis \
! 8#305 /Aring \
! \n\
! 8#306 /AE \
! 8#307 /Ccedilla \
! 8#310 /Egrave \
! 8#311 /Eacute \
! \n\
! 8#312 /Ecircumflex \
! 8#313 /Edieresis \
! 8#314 /Igrave \
! 8#315 /Iacute \
! \n\
! 8#316 /Icircumflex \
! 8#317 /Idieresis \
! 8#321 /Ntilde \
! 8#322 /Ograve \
! \n\
! 8#323 /Oacute \
! 8#324 /Ocircumflex \
! 8#325 /Otilde \
! 8#326 /Odieresis \
! \n\
! 8#330 /Oslash \
! 8#331 /Ugrave \
! 8#332 /Uacute \
! 8#333 /Ucircumflex \
! \n\
! 8#334 /Udieresis \
! 8#337 /germandbls \
! 8#340 /agrave \
! 8#341 /aacute \
! \n\
! 8#342 /acircumflex \
! 8#343 /atilde \
! 8#344 /adieresis \
! 8#345 /aring \
! \n\
! 8#346 /ae \
! 8#347 /ccedilla \
! 8#350 /egrave \
! 8#351 /eacute \
! \n\
! 8#352 /ecircumflex \
! 8#353 /edieresis \
! 8#354 /igrave \
! 8#355 /iacute \
! \n\
! %8#356 /icircumflex \
! 8#357 /idieresis \
! 8#361 /ntilde \
! 8#362 /ograve \
! \n\
! 8#363 /oacute \
! 8#364 /ocircumflex \
! 8#365 /otilde \
! 8#366 /odieresis \
! \n\
! 8#370 /oslash \
! 8#371 /ugrave \
! 8#372 /uacute \
! 8#373 /ucircumflex \
! \n\
! 8#374 /udieresis \
! 8#377 /ydieresis \
  ] def\n\
  "
--- 116,144 ----
  newfontname newfont definefont pop end } def\n\
  /isovec [ \n\
! 8#200 /grave 8#201 /acute 8#202 /circumflex 8#203 /tilde\n\
! 8#204 /macron 8#205 /breve 8#206 /dotaccent 8#207 /dieresis\n\
! 8#210 /ring 8#211 /cedilla 8#212 /hungarumlaut 8#213 /ogonek 8#214 /caron\n\
! 8#220 /dotlessi 8#240 /space 8#241 /exclamdown 8#242 /cent 8#243 /sterling\n\
! 8#244 /currency 8#245 /yen 8#246 /brokenbar 8#247 /section 8#250 /dieresis\n\
! 8#251 /copyright 8#252 /ordfeminine 8#253 /guillemotleft 8#254 /logicalnot\n\
! 8#255 /endash 8#256 /registered 8#257 /macron 8#260 /degree 8#261 /plusminus\n\
! 8#262 /twosuperior 8#263 /threesuperior 8#264 /acute 8#265 /mu 8#266 /paragraph\n\
! 8#267 /periodcentered 8#270 /cedilla 8#271 /onesuperior 8#272 /ordmasculine\n\
! 8#273 /guillemotright 8#274 /onequarter 8#275 /onehalf \n\
! 8#276 /threequarters 8#277 /questiondown 8#300 /Agrave 8#301 /Aacute\n\
! 8#302 /Acircumflex 8#303 /Atilde 8#304 /Adieresis 8#305 /Aring\n\
! 8#306 /AE 8#307 /Ccedilla 8#310 /Egrave 8#311 /Eacute\n\
! 8#312 /Ecircumflex 8#313 /Edieresis 8#314 /Igrave 8#315 /Iacute\n\
! 8#316 /Icircumflex 8#317 /Idieresis 8#320 /Eth 8#321 /Ntilde 8#322 /Ograve\n\
! 8#323 /Oacute 8#324 /Ocircumflex 8#325 /Otilde 8#326 /Odieresis 8#327 /multiply\n\
! 8#330 /Oslash 8#331 /Ugrave 8#332 /Uacute 8#333 /Ucircumflex\n\
! 8#334 /Udieresis 8#335 /Yacute 8#336 /Thorn 8#337 /germandbls 8#340 /agrave\n\
! 8#341 /aacute 8#342 /acircumflex 8#343 /atilde 8#344 /adieresis 8#345 /aring\n\
! 8#346 /ae 8#347 /ccedilla 8#350 /egrave 8#351 /eacute\n\
! 8#352 /ecircumflex 8#353 /edieresis 8#354 /igrave 8#355 /iacute\n\
! 8#356 /icircumflex 8#357 /idieresis 8#360 /eth 8#361 /ntilde 8#362 /ograve\n\
! 8#363 /oacute 8#364 /ocircumflex 8#365 /otilde 8#366 /odieresis 8#367 /divide\n\
! 8#370 /oslash 8#371 /ugrave 8#372 /uacute 8#373 /ucircumflex\n\
! 8#374 /udieresis 8#375 /yacute 8#376 /thorn 8#377 /ydieresis \
  ] def\n\
  "
***************
*** 237,243 ****
  #define		END_PROLOG	"\
  	end\n\
! 	/$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def\n\
! 	/$F2psEnd {$F2psEnteredState restore end} def\n\
! 	%%EndProlog\n\
  "
  
--- 183,189 ----
  #define		END_PROLOG	"\
  	end\n\
! /$F2psBegin {$F2psDict begin /$F2psEnteredState save def} def\n\
! /$F2psEnd {$F2psEnteredState restore end} def\n\
! %%EndProlog\n\
  "
  
***************
*** 396,405 ****
              {
                  fprintf(tfp, "%d 0 translate 90 rotate\n", pagewidth);
-                 fprintf(tfp, "%f %f translate %.3f %.3f scale\n",
-                         origx+dx, origy+dy, scalex, scaley);
-             } else {
-                fprintf(tfp, "%f %f translate %.3f %.3f scale\n",
-                        origx-dx, origy+dy, scalex, scaley);
              }
              for (i=0; i<no_obj; i++)
  	    {
--- 342,348 ----
              {
                  fprintf(tfp, "%d 0 translate 90 rotate\n", pagewidth);
              }
+             fprintf(tfp, "%f %f translate %.3f %.3f scale\n",
+                        origx-dx, origy+dy, scalex, scaley);
              for (i=0; i<no_obj; i++)
  	    {


